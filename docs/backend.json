{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Series Tracker application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "joinDate": {
          "type": "string",
          "description": "The date and time the user joined the application.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "joinDate"
      ]
    },
    "TvShow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TvShow",
      "type": "object",
      "description": "Represents a TV show.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TV show."
        },
        "title": {
          "type": "string",
          "description": "The title of the TV show."
        },
        "genre": {
          "type": "array",
          "description": "The genre of the TV show.",
          "items": {
            "type": "string"
          }
        },
        "description": {
          "type": "string",
          "description": "A description of the tv show."
        }
      },
      "required": [
        "id",
        "title",
        "genre",
        "description"
      ]
    },
    "Episode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Episode",
      "type": "object",
      "description": "Represents an episode of a TV show.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the episode."
        },
        "tvShowId": {
          "type": "string",
          "description": "Reference to TvShow. (Relationship: TvShow 1:N Episode)"
        },
        "seasonNumber": {
          "type": "number",
          "description": "The season number of the episode."
        },
        "episodeNumber": {
          "type": "number",
          "description": "The episode number within the season."
        },
        "title": {
          "type": "string",
          "description": "The title of the episode."
        }
      },
      "required": [
        "id",
        "tvShowId",
        "seasonNumber",
        "episodeNumber",
        "title"
      ]
    },
    "WatchlistItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WatchlistItem",
      "type": "object",
      "description": "Represents a TV show in a user's watchlist.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the watchlist item."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N WatchlistItem)"
        },
        "tvShowId": {
          "type": "string",
          "description": "Reference to TvShow. (Relationship: TvShow 1:N WatchlistItem)"
        },
        "addedDate": {
          "type": "string",
          "description": "The date the TV show was added to the watchlist.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "tvShowId",
        "addedDate"
      ]
    },
    "EpisodeProgress": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EpisodeProgress",
      "type": "object",
      "description": "Represents a user's progress on a specific episode.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the episode progress."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N EpisodeProgress)"
        },
        "episodeId": {
          "type": "string",
          "description": "Reference to Episode. (Relationship: Episode 1:N EpisodeProgress)"
        },
        "watchedDate": {
          "type": "string",
          "description": "The date the episode was watched.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "episodeId",
        "watchedDate"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a user's review of a TV show.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review)"
        },
        "tvShowId": {
          "type": "string",
          "description": "Reference to TvShow. (Relationship: TvShow 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "The user's rating of the TV show (e.g., 1-5 stars)."
        },
        "reviewText": {
          "type": "string",
          "description": "The user's written review of the TV show."
        },
        "reviewDate": {
          "type": "string",
          "description": "The date the review was written.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "tvShowId",
        "rating",
        "reviewText",
        "reviewDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Uses path-based ownership for all user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/tv_shows/{tvShowId}",
        "definition": {
          "entityName": "TvShow",
          "schema": {
            "$ref": "#/backend/entities/TvShow"
          },
          "description": "Stores information about TV shows.",
          "params": [
            {
              "name": "tvShowId",
              "description": "The unique identifier of the TV show."
            }
          ]
        }
      },
      {
        "path": "/tv_shows/{tvShowId}/episodes/{episodeId}",
        "definition": {
          "entityName": "Episode",
          "schema": {
            "$ref": "#/backend/entities/Episode"
          },
          "description": "Stores information about episodes of TV shows.",
          "params": [
            {
              "name": "tvShowId",
              "description": "The unique identifier of the TV show."
            },
            {
              "name": "episodeId",
              "description": "The unique identifier of the episode."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/watchlist/{watchlistItemId}",
        "definition": {
          "entityName": "WatchlistItem",
          "schema": {
            "$ref": "#/backend/entities/WatchlistItem"
          },
          "description": "Stores watchlist items for each user.  Uses path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "watchlistItemId",
              "description": "The unique identifier of the watchlist item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/episode_progress/{episodeProgressId}",
        "definition": {
          "entityName": "EpisodeProgress",
          "schema": {
            "$ref": "#/backend/entities/EpisodeProgress"
          },
          "description": "Stores episode progress for each user. Uses path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "episodeProgressId",
              "description": "The unique identifier of the episode progress."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores user reviews of TV shows. Uses path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier of the review."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the core features of the Series Tracker application, focusing on user authentication and data organization for TV shows, watchlists, episode tracking, and reviews.  The primary focus is on path-based ownership for user-specific data (watchlists, episode progress, reviews) and leveraging this for secure and efficient data access. \n\nAuthorization Independence (CRITICAL): Path-based ownership automatically ensures authorization independence, eliminating the need for `get()` calls in security rules. For instance, the `/users/{userId}/watchlist/{watchlistItemId}` structure inherently ties watchlist items to a specific user, making authorization straightforward based on the request's authentication state (`request.auth.uid`).\n\nClarity of Intent (Debuggability): The structure clearly separates user-owned data into subcollections under `/users/{userId}`, making the intent of ownership explicit.\n\nDBAC (No Custom Claims): Authorization relies solely on `request.auth.uid` and path-based ownership.\n\nQAPs (Rules are not Filters): The path-based ownership strategy enables secure list operations. Listing watchlist items under `/users/{userId}/watchlist` only requires checking if `request.auth.uid == userId`, preventing unauthorized data access.\n\nInvariants:  Ownership of watchlists, episode progress, and reviews is inherently enforced by the path structure, preventing unauthorized modification.\n\nSegregation: Data with different access needs are kept in separate collections.  User-specific data is stored under the `/users/{userId}` path, while general TV show data is stored in the `/tv_shows` collection.\n\nAccess Modeling:  Path-based ownership is used for user-owned data (watchlists, episode progress, reviews). This access modeling strategy aligns with the principle of least privilege and promotes efficient security rule evaluation.\n\nData Clarity and Predictability:  The schema enforces strict naming conventions (e.g., `userId` for user identifiers), creating a predictable and consistent data structure.  There is no use of a status field or dynamic keys."
  }
}